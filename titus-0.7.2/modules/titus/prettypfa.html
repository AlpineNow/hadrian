

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>titus.prettypfa &mdash; Titus TRUNK documentation</title>
    
    <link rel="stylesheet" href="../../static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     'TRUNK',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../static/jquery.js"></script>
    <script type="text/javascript" src="../../static/underscore.js"></script>
    <script type="text/javascript" src="../../static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Titus TRUNK documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Titus TRUNK documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for titus.prettypfa</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>

<span class="c"># Copyright (C) 2014  Open Data (&quot;Open Data&quot; refers to</span>
<span class="c"># one or more of the following companies: Open Data Partners LLC,</span>
<span class="c"># Open Data Research LLC, or Open Data Capital LLC.)</span>
<span class="c"># </span>
<span class="c"># This file is part of Hadrian.</span>
<span class="c"># </span>
<span class="c"># Licensed under the Hadrian Personal Use and Evaluation License (PUEL);</span>
<span class="c"># you may not use this file except in compliance with the License.</span>
<span class="c"># You may obtain a copy of the License at</span>
<span class="c"># </span>
<span class="c">#     http://raw.githubusercontent.com/opendatagroup/hadrian/master/LICENSE</span>
<span class="c"># </span>
<span class="c"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c"># See the License for the specific language governing permissions and</span>
<span class="c"># limitations under the License.</span>

<span class="kn">import</span> <span class="nn">ast</span> <span class="kn">as</span> <span class="nn">pythonast</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">json</span> <span class="kn">as</span> <span class="nn">jsonlib</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Subs</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">validSymbolName</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">validFunctionName</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Ast</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Method</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">EngineConfig</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Cell</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Argument</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Expression</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">LiteralValue</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">PathIndex</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">ArrayIndex</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">MapIndex</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">RecordIndex</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">HasPath</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">FcnDef</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">FcnRef</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">FcnRefFill</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">CallUserFcn</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Call</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Ref</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">LiteralNull</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">LiteralBoolean</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">LiteralInt</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">LiteralLong</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">LiteralFloat</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">LiteralDouble</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">LiteralString</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">LiteralBase64</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Literal</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">NewObject</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">NewArray</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Do</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Let</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">SetVar</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">AttrGet</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">AttrTo</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">CellGet</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">CellTo</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">PoolGet</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">PoolTo</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">If</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Cond</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">While</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">DoUntil</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">For</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Foreach</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Forkeyval</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">CastCase</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">CastBlock</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Upcast</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">BinaryFormatter</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Pack</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Unpack</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">IfNotNull</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Doc</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Error</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Try</span>
<span class="kn">from</span> <span class="nn">titus.pfaast</span> <span class="kn">import</span> <span class="n">Log</span>
<span class="kn">from</span> <span class="nn">titus.datatype</span> <span class="kn">import</span> <span class="n">AvroTypeBuilder</span>
<span class="kn">from</span> <span class="nn">titus.errors</span> <span class="kn">import</span> <span class="n">PFASyntaxException</span>
<span class="kn">from</span> <span class="nn">titus.errors</span> <span class="kn">import</span> <span class="n">PrettyPfaException</span>
<span class="kn">from</span> <span class="nn">titus.genpy</span> <span class="kn">import</span> <span class="n">PFAEngine</span>
<span class="kn">import</span> <span class="nn">titus.pfaast</span>
<span class="kn">import</span> <span class="nn">titus.util</span>
<span class="kn">from</span> <span class="nn">titus.util</span> <span class="kn">import</span> <span class="n">avscToPretty</span>
<span class="kn">from</span> <span class="nn">titus.reader</span> <span class="kn">import</span> <span class="n">jsonToAst</span>

<div class="viewcode-block" id="Token"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Token">[docs]</a><span class="k">class</span> <span class="nc">Token</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">lineno</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">v</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="n">lineno</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;{0}({1})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="InterpretationState"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.InterpretationState">[docs]</a><span class="k">class</span> <span class="nc">InterpretationState</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">avroTypeBuilder</span> <span class="o">=</span> <span class="n">AvroTypeBuilder</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">avroTypeMemo</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">avroTypeAlias</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functionNames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">titus</span><span class="o">.</span><span class="n">pfaast</span><span class="o">.</span><span class="n">FunctionTable</span><span class="o">.</span><span class="n">blank</span><span class="p">()</span><span class="o">.</span><span class="n">functions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cellNames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poolNames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Section"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Section">[docs]</a><span class="k">class</span> <span class="nc">Section</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">lineno</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="n">lineno</span>

        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;name&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;method&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;input&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;output&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;types&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">MiniCall</span><span class="p">)</span> <span class="ow">and</span> <span class="n">content</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;do&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">args</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">content</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;begin&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">MiniCall</span><span class="p">)</span> <span class="ow">and</span> <span class="n">content</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;do&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">args</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">content</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;action&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">MiniCall</span><span class="p">)</span> <span class="ow">and</span> <span class="n">content</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;do&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">args</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">content</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;end&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">MiniCall</span><span class="p">)</span> <span class="ow">and</span> <span class="n">content</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;do&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">args</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">content</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;fcns&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;zero&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;merge&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">MiniCall</span><span class="p">)</span> <span class="ow">and</span> <span class="n">content</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;do&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">args</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">content</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;cells&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;pools&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;randseed&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;doc&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;version&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;metadata&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;options&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;Unrecognized section heading </span><span class="se">\&quot;</span><span class="s">{0}</span><span class="se">\&quot;</span><span class="s"> at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">lineno</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;Section({0}, {1} at {2})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

<div class="viewcode-block" id="Section.input"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Section.input">[docs]</a>    <span class="k">def</span> <span class="nf">input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;Only one item allowed in input section&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeBuilder</span><span class="o">.</span><span class="n">makePlaceholder</span><span class="p">(</span><span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">asType</span><span class="p">(</span><span class="n">state</span><span class="p">)),</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeMemo</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section.output"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Section.output">[docs]</a>    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;Only one item allowed in output section&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeBuilder</span><span class="o">.</span><span class="n">makePlaceholder</span><span class="p">(</span><span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">asType</span><span class="p">(</span><span class="n">state</span><span class="p">)),</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeMemo</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section.cells"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Section.cells">[docs]</a>    <span class="k">def</span> <span class="nf">cells</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">asCell</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section.pools"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Section.pools">[docs]</a>    <span class="k">def</span> <span class="nf">pools</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">asPool</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section.method"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Section.method">[docs]</a>    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;Only one item allowed in method section&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">MiniString</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">MiniDotName</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;method must be a string at PrettyPFA line {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="s">&quot;map&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Method</span><span class="o">.</span><span class="n">MAP</span>
        <span class="k">elif</span> <span class="n">out</span> <span class="o">==</span> <span class="s">&quot;emit&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Method</span><span class="o">.</span><span class="n">EMIT</span>
        <span class="k">elif</span> <span class="n">out</span> <span class="o">==</span> <span class="s">&quot;fold&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Method</span><span class="o">.</span><span class="n">FOLD</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;method must be </span><span class="se">\&quot;</span><span class="s">map</span><span class="se">\&quot;</span><span class="s">, </span><span class="se">\&quot;</span><span class="s">emit</span><span class="se">\&quot;</span><span class="s">, or </span><span class="se">\&quot;</span><span class="s">fold</span><span class="se">\&quot;</span><span class="s"> at PrettyPFA line {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Section.types"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Section.types">[docs]</a>    <span class="k">def</span> <span class="nf">types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
            <span class="n">x</span><span class="o">.</span><span class="n">defType</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section.begin"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Section.begin">[docs]</a>    <span class="k">def</span> <span class="nf">begin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Section.action"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Section.action">[docs]</a>    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Section.end"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Section.end">[docs]</a>    <span class="k">def</span> <span class="nf">end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Section.fcns"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Section.fcns">[docs]</a>    <span class="k">def</span> <span class="nf">fcns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">asFcn</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Section.zero"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Section.zero">[docs]</a>    <span class="k">def</span> <span class="nf">zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;Only one item allowed in zero section&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">asJson</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="Section.merge"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Section.merge">[docs]</a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Section.randseed"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Section.randseed">[docs]</a>    <span class="k">def</span> <span class="nf">randseed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;Only one item allowed in randseed section&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">MiniNumber</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;randseed must be an integer at PrettyPFA line {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">value</span>
</div>
<div class="viewcode-block" id="Section.doc"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Section.doc">[docs]</a>    <span class="k">def</span> <span class="nf">doc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;Only one item allowed in doc section&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">MiniString</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">MiniDotName</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;doc must be a string at PrettyPFA line {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">out</span>
</div>
<div class="viewcode-block" id="Section.version"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Section.version">[docs]</a>    <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;Only one item allowed in version section&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">MiniNumber</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;version must be an integer at PrettyPFA line {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">value</span>
</div>
<div class="viewcode-block" id="Section.metadata"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Section.metadata">[docs]</a>    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;Only one item allowed in metadata section&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">asJson</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Section.options"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Section.options">[docs]</a>    <span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;Only one item allowed in options section&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">asJson</span><span class="p">()</span>
</div></div>
<div class="viewcode-block" id="MiniAst"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniAst">[docs]</a><span class="k">class</span> <span class="nc">MiniAst</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span>
    <span class="nd">@property</span>
<div class="viewcode-block" id="MiniAst.pos"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniAst.pos">[docs]</a>    <span class="k">def</span> <span class="nf">pos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">low</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">high</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;PrettyPFA line {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">low</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;PrettyPFA lines {0}-{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">high</span><span class="p">)</span></div>
<div class="viewcode-block" id="MiniAst.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniAst.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;{0} ({1}) is not an expression at {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span></div>
<div class="viewcode-block" id="MiniAst.asType"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniAst.asType">[docs]</a>    <span class="k">def</span> <span class="nf">asType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;{0} ({1}) is not a type specification at {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span></div>
<div class="viewcode-block" id="MiniAst.asJson"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniAst.asJson">[docs]</a>    <span class="k">def</span> <span class="nf">asJson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;{0} ({1}) is not JSON at {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span></div>
<div class="viewcode-block" id="MiniAst.asFcn"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniAst.asFcn">[docs]</a>    <span class="k">def</span> <span class="nf">asFcn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;{0} ({1}) is not a function definition at {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span></div>
<div class="viewcode-block" id="MiniAst.asCell"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniAst.asCell">[docs]</a>    <span class="k">def</span> <span class="nf">asCell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;{0} ({1}) is not a cell definition at {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span></div>
<div class="viewcode-block" id="MiniAst.asPool"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniAst.asPool">[docs]</a>    <span class="k">def</span> <span class="nf">asPool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;{0} ({1}) is not a cell definition at {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span></div>
<div class="viewcode-block" id="MiniAst.defType"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniAst.defType">[docs]</a>    <span class="k">def</span> <span class="nf">defType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;{0} ({1}) is not a type definition at {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
</div></div>
<div class="viewcode-block" id="ResolvedSubs"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.ResolvedSubs">[docs]</a><span class="k">class</span> <span class="nc">ResolvedSubs</span><span class="p">(</span><span class="n">Token</span><span class="p">,</span> <span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lineno</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="n">lineno</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">low</span> <span class="o">=</span> <span class="n">lineno</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="n">lineno</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;&lt;&lt;{0} = {1}&gt;&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<div class="viewcode-block" id="ResolvedSubs.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.ResolvedSubs.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">Ast</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ppfa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pfa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>
<div class="viewcode-block" id="ResolvedSubs.asType"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.ResolvedSubs.asType">[docs]</a>    <span class="k">def</span> <span class="nf">asType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span></div>
<div class="viewcode-block" id="ResolvedSubs.asJson"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.ResolvedSubs.asJson">[docs]</a>    <span class="k">def</span> <span class="nf">asJson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
</div></div>
<div class="viewcode-block" id="MiniGenGet"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniGenGet">[docs]</a><span class="k">class</span> <span class="nc">MiniGenGet</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniGenGet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniGenGet({0}, {1})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
<div class="viewcode-block" id="MiniGenGet.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniGenGet.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">AttrGet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">),</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="MiniGet"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniGet">[docs]</a><span class="k">class</span> <span class="nc">MiniGet</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniGet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniGet({0}, {1})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
<div class="viewcode-block" id="MiniGet.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniGet.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&quot;.&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">pieces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">pieces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">LiteralString</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pieces</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">cellNames</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CellGet</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">poolNames</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PoolGet</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">AttrGet</span><span class="p">(</span><span class="n">Ref</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">),</span> <span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="MiniTo"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniTo">[docs]</a><span class="k">class</span> <span class="nc">MiniTo</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">direct</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direct</span> <span class="o">=</span> <span class="n">direct</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to</span> <span class="o">=</span> <span class="n">to</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">init</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniTo</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniTo({0}, {1}, {2}, {3}, {4})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">direct</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">to</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">)</span>
<div class="viewcode-block" id="MiniTo.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniTo.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&quot;.&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">pieces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">pieces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">LiteralString</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pieces</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>

        <span class="n">to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direct</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">FcnRef</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;direct assignments (with an = sign) cannot refer to functions, such as {0} at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="p">(</span><span class="n">FcnDef</span><span class="p">,</span> <span class="n">FcnRefFill</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;direct assignments (with an = sign) cannot refer to functions, such as {0} at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="p">(</span><span class="n">FcnRef</span><span class="p">,</span> <span class="n">FcnDef</span><span class="p">,</span> <span class="n">FcnRefFill</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;indirect assignments (with a </span><span class="se">\&quot;</span><span class="s">to</span><span class="se">\&quot;</span><span class="s"> keyword) must refer to functions, not {0} at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">poolNames</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;indirect pool assignments (with a </span><span class="se">\&quot;</span><span class="s">to</span><span class="se">\&quot;</span><span class="s"> keyword) must also have an </span><span class="se">\&quot;</span><span class="s">init</span><span class="se">\&quot;</span><span class="s"> at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">base</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">poolNames</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;non-pool assignments must not have an </span><span class="se">\&quot;</span><span class="s">init</span><span class="se">\&quot;</span><span class="s"> at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">cellNames</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CellTo</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">poolNames</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">PoolTo</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">AttrTo</span><span class="p">(</span><span class="n">Ref</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">),</span> <span class="n">path</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="MiniEnumSymbol"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniEnumSymbol">[docs]</a><span class="k">class</span> <span class="nc">MiniEnumSymbol</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enumType</span><span class="p">,</span> <span class="n">enumValue</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enumType</span> <span class="o">=</span> <span class="n">enumType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enumValue</span> <span class="o">=</span> <span class="n">enumValue</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniEnumSymbol</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniEnumSymbols({0}, {1})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enumType</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enumValue</span><span class="p">)</span>
<div class="viewcode-block" id="MiniEnumSymbol.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniEnumSymbol.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Literal</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">avroTypeBuilder</span><span class="o">.</span><span class="n">makePlaceholder</span><span class="p">(</span><span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enumType</span><span class="p">),</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeMemo</span><span class="p">),</span> <span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enumValue</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="MiniDotName"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniDotName">[docs]</a><span class="k">class</span> <span class="nc">MiniDotName</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">lineno</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniDotName</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">lineno</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MiniDotName</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniDotName({0})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<div class="viewcode-block" id="MiniDotName.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniDotName.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;null&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">LiteralNull</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;true&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">LiteralBoolean</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;false&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">LiteralBoolean</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">functionNames</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FcnRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&quot;.&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="n">pieces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">pieces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">LiteralString</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pieces</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
                <span class="k">if</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">cellNames</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">CellGet</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">poolNames</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">PoolGet</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">AttrGet</span><span class="p">(</span><span class="n">Ref</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">),</span> <span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">cellNames</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">CellGet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">poolNames</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">PoolGet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">Ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span></div>
<div class="viewcode-block" id="MiniDotName.asType"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniDotName.asType">[docs]</a>    <span class="k">def</span> <span class="nf">asType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeAlias</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeAlias</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>
<div class="viewcode-block" id="MiniDotName.asJson"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniDotName.asJson">[docs]</a>    <span class="k">def</span> <span class="nf">asJson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;null&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;true&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;false&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</div></div>
<div class="viewcode-block" id="MiniNumber"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniNumber">[docs]</a><span class="k">class</span> <span class="nc">MiniNumber</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lineno</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniNumber</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">lineno</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniNumber({0})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
<div class="viewcode-block" id="MiniNumber.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniNumber.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">LiteralInt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">LiteralDouble</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span></div>
<div class="viewcode-block" id="MiniNumber.asJson"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniNumber.asJson">[docs]</a>    <span class="k">def</span> <span class="nf">asJson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
</div></div>
<div class="viewcode-block" id="MiniString"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniString">[docs]</a><span class="k">class</span> <span class="nc">MiniString</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">lineno</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniString</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">lineno</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniString({0})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
<div class="viewcode-block" id="MiniString.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniString.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">LiteralString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span></div>
<div class="viewcode-block" id="MiniString.asJson"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniString.asJson">[docs]</a>    <span class="k">def</span> <span class="nf">asJson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
</div></div>
<div class="viewcode-block" id="MiniCall"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniCall">[docs]</a><span class="k">class</span> <span class="nc">MiniCall</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">low0</span><span class="p">,</span> <span class="n">high0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">low</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">low</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
            <span class="n">high</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">high</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">low0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">low</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">low0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">high0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">high</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">high</span><span class="p">,</span> <span class="n">high0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">low0</span><span class="p">,</span> <span class="n">high0</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniCall</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniCall({0}, [{1}])&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)))</span>

<div class="viewcode-block" id="MiniCall.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniCall.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;json&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;json function must have 2 arguments, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="n">td</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asType</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">asJson</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">td</span> <span class="o">==</span> <span class="s">&quot;null&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">LiteralNull</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">td</span> <span class="o">==</span> <span class="s">&quot;int&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">LiteralInt</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">td</span> <span class="o">==</span> <span class="s">&quot;long&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">LiteralLong</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">td</span> <span class="o">==</span> <span class="s">&quot;float&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">LiteralFloat</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">td</span> <span class="o">==</span> <span class="s">&quot;double&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">LiteralDouble</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">td</span> <span class="o">==</span> <span class="s">&quot;string&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">LiteralString</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">td</span> <span class="o">==</span> <span class="s">&quot;bytes&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">LiteralBase64</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Literal</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">avroTypeBuilder</span><span class="o">.</span><span class="n">makePlaceholder</span><span class="p">(</span><span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeMemo</span><span class="p">),</span> <span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;int&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;int function must have 1 argument, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">LiteralInt</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asJson</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;long&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;long function must have 1 argument, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">LiteralLong</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asJson</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;float&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;float function must have 1 argument, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">LiteralFloat</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asJson</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;double&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;double function must have 1 argument, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">LiteralDouble</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asJson</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;string&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;string function must have 1 argument, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">LiteralString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asJson</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;bytes&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;bytes function must have 1 argument, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">LiteralBase64</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asJson</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;do&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Do</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">])</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;apply&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;apply function must have at least 1 argument, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">CallUserFcn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">),</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;update&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;update function must have exactly 2 arguments, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">MiniParam</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;update function second argument must be a key-value pair, not a plain expression, at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">AttrTo</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="p">[</span><span class="n">LiteralString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;new&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;new function must have at least 2 arguments, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="n">td</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asType</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">td</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="n">td</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;array&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MiniParam</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                    <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;new array must only consist of plain expressions, not key-value pairs, at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">NewArray</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]],</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeBuilder</span><span class="o">.</span><span class="n">makePlaceholder</span><span class="p">(</span><span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeMemo</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MiniParam</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                    <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;new map/record must only consist of key-value pairs, not plain expressions, at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">NewObject</span><span class="p">(</span><span class="nb">dict</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">typeExpr</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]),</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeBuilder</span><span class="o">.</span><span class="n">makePlaceholder</span><span class="p">(</span><span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">td</span><span class="p">),</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeMemo</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;upcast&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;upcast function requires exactly 2 arguments, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeBuilder</span><span class="o">.</span><span class="n">makePlaceholder</span><span class="p">(</span><span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asType</span><span class="p">(</span><span class="n">state</span><span class="p">)),</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeMemo</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Upcast</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;pack&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MiniParam</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;pack function requires at least one argument and all arguments must be format-expression pairs&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Pack</span><span class="p">([(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">typeExpr</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;doc&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;doc function has only 1 argument, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">MiniString</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;doc function argument must be a string, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">Doc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;error&quot;</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MiniParam</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">code</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s">&quot;code&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;error function has only 1 optional parameter, </span><span class="se">\&quot;</span><span class="s">code</span><span class="se">\&quot;</span><span class="s">, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span><span class="p">,</span> <span class="n">MiniNumber</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;error function has optional parameter </span><span class="se">\&quot;</span><span class="s">code</span><span class="se">\&quot;</span><span class="s"> must be an integer, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
                <span class="n">code</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span><span class="o">.</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;error function has only 1 optional parameter, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>

            <span class="n">others</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MiniParam</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">others</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;error function requires exactly 1 argument, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">others</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">others</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">MiniDotName</span><span class="p">,</span> <span class="n">MiniString</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;error function argument must be a string, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">others</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">others</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">MiniDotName</span><span class="p">):</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">others</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">others</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="k">return</span> <span class="n">Error</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;log&quot;</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MiniParam</span><span class="p">)]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">namespace</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s">&quot;namespace&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;log function has only 1 optional parameter, </span><span class="se">\&quot;</span><span class="s">namespace</span><span class="se">\&quot;</span><span class="s">, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span><span class="p">,</span> <span class="p">(</span><span class="n">MiniDotName</span><span class="p">,</span> <span class="n">MiniString</span><span class="p">)):</span>
                    <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;log function has optional parameter </span><span class="se">\&quot;</span><span class="s">namespace</span><span class="se">\&quot;</span><span class="s"> must be a string, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span><span class="p">,</span> <span class="n">MiniDotName</span><span class="p">):</span>
                    <span class="n">namespace</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span><span class="o">.</span><span class="n">name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">namespace</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span><span class="o">.</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;log function has only 1 optional parameter, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">Log</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MiniParam</span><span class="p">)],</span> <span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MiniParam</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">):</span>
            <span class="n">fill</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">typeExpr</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MiniParam</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">FcnRefFill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Call</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiniCall.asType"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniCall.asType">[docs]</a>    <span class="k">def</span> <span class="nf">asType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">if</span> <span class="s">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">pieces</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="s">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pieces</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">pieces</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="n">name</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;array&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;array type should have 1 argument, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;array&quot;</span><span class="p">,</span> <span class="s">&quot;items&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asType</span><span class="p">(</span><span class="n">state</span><span class="p">)}</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;map&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;map type should have 1 argument, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;map&quot;</span><span class="p">,</span> <span class="s">&quot;values&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asType</span><span class="p">(</span><span class="n">state</span><span class="p">)}</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;union&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;union type should have at least 2 arguments, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asType</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;fixed&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;fixed type should have 1 or 2 arguments, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">MiniNumber</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">))</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;fixed type first argument should be a positive integer, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">MiniDotName</span><span class="p">):</span>
                    <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">MiniDotName</span><span class="p">):</span>
                    <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;fixed type second argument should be an identifier, not </span><span class="se">\&quot;</span><span class="s">{0}</span><span class="se">\&quot;</span><span class="s">, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">titus</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">uniqueFixedName</span><span class="p">()</span>

            <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;fixed&quot;</span><span class="p">,</span> <span class="s">&quot;size&quot;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">namespace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="s">&quot;namespace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">namespace</span>
            <span class="k">return</span> <span class="n">out</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;enum&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;enum type should have 1 or 2 arguments, not {0} at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">MiniBracketedArgs</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;enum type first argument should be a bracketed list of valid enum symbols, not </span><span class="se">\&quot;</span><span class="s">{0}</span><span class="se">\&quot;</span><span class="s">, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MiniDotName</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;enum type symbols must all be valid dot names, not </span><span class="se">\&quot;</span><span class="s">{0}</span><span class="se">\&quot;</span><span class="s">, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">MiniDotName</span><span class="p">):</span>
                    <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ResolvedSubs</span><span class="p">):</span>
                    <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;fixed type second argument should be an identifier, not </span><span class="se">\&quot;</span><span class="s">{0}</span><span class="se">\&quot;</span><span class="s">, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">titus</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">uniqueEnumName</span><span class="p">()</span>

            <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;enum&quot;</span><span class="p">,</span> <span class="s">&quot;symbols&quot;</span><span class="p">:</span> <span class="n">symbols</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">namespace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="s">&quot;namespace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">namespace</span>
            <span class="k">return</span> <span class="n">out</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;record&quot;</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">others</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">MiniParam</span><span class="p">):</span>
                    <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="n">arg</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="n">arg</span><span class="o">.</span><span class="n">typeExpr</span><span class="o">.</span><span class="n">asType</span><span class="p">(</span><span class="n">state</span><span class="p">)})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">others</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">others</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">titus</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">uniqueRecordName</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">others</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">others</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ResolvedSubs</span><span class="p">):</span>
                    <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">others</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">namespace</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">others</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;apart from the field specifiers (which have colons), record type takes 0 or 1 argument, not {0} at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">others</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>

            <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="s">&quot;record&quot;</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s">&quot;fields&quot;</span><span class="p">:</span> <span class="n">fields</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">namespace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="s">&quot;namespace&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">namespace</span>
            <span class="k">return</span> <span class="n">out</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;unrecognized type function </span><span class="se">\&quot;</span><span class="s">{0}</span><span class="se">\&quot;</span><span class="s"> at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="MiniCall.defType"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniCall.defType">[docs]</a>    <span class="k">def</span> <span class="nf">defType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;record&quot;</span><span class="p">,</span> <span class="s">&quot;enum&quot;</span><span class="p">,</span> <span class="s">&quot;fixed&quot;</span><span class="p">):</span>
            <span class="n">jsonNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asType</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="n">alias</span> <span class="o">=</span> <span class="n">jsonNode</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&quot;namespace&quot;</span> <span class="ow">in</span> <span class="n">jsonNode</span><span class="p">:</span>
                <span class="n">alias</span> <span class="o">=</span> <span class="n">jsonNode</span><span class="p">[</span><span class="s">&quot;namespace&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">alias</span>
            <span class="n">state</span><span class="o">.</span><span class="n">avroTypeAlias</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">jsonNode</span>
            <span class="n">state</span><span class="o">.</span><span class="n">avroTypeBuilder</span><span class="o">.</span><span class="n">makePlaceholder</span><span class="p">(</span><span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">jsonNode</span><span class="p">),</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeMemo</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">MiniCall</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">defType</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="MiniBlock"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniBlock">[docs]</a><span class="k">class</span> <span class="nc">MiniBlock</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exprs</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exprs</span> <span class="o">=</span> <span class="n">exprs</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniBlock</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniBlock({0})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprs</span><span class="p">))</span>
<div class="viewcode-block" id="MiniBlock.asJson"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniBlock.asJson">[docs]</a>    <span class="k">def</span> <span class="nf">asJson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exprs</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">MiniParam</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;JSON object must contain only key-value pairs at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="n">out</span><span class="p">[</span><span class="n">expr</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">typeExpr</span><span class="o">.</span><span class="n">asJson</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">out</span>
</div></div>
<div class="viewcode-block" id="MiniBracketedArgs"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniBracketedArgs">[docs]</a><span class="k">class</span> <span class="nc">MiniBracketedArgs</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniBracketedArgs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniBracketedArgs({0})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">]))</span>
<div class="viewcode-block" id="MiniBracketedArgs.asJson"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniBracketedArgs.asJson">[docs]</a>    <span class="k">def</span> <span class="nf">asJson</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asJson</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
</div></div>
<div class="viewcode-block" id="MiniParam"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniParam">[docs]</a><span class="k">class</span> <span class="nc">MiniParam</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">typeExpr</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typeExpr</span> <span class="o">=</span> <span class="n">typeExpr</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniParam</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniParam({0}, {1})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">typeExpr</span><span class="p">))</span>
<div class="viewcode-block" id="MiniParam.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniParam.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeBuilder</span><span class="o">.</span><span class="n">makePlaceholder</span><span class="p">(</span><span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">typeExpr</span><span class="o">.</span><span class="n">asType</span><span class="p">(</span><span class="n">state</span><span class="p">)),</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeMemo</span><span class="p">)}</span>
</div></div>
<div class="viewcode-block" id="MiniFcnDef"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniFcnDef">[docs]</a><span class="k">class</span> <span class="nc">MiniFcnDef</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">retType</span><span class="p">,</span> <span class="n">definition</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retType</span> <span class="o">=</span> <span class="n">retType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">definition</span> <span class="o">=</span> <span class="n">definition</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniFcnDef</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniFcnDef({0}, {1}, {2})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)),</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retType</span><span class="p">),</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">definition</span><span class="p">)))</span>
<div class="viewcode-block" id="MiniFcnDef.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniFcnDef.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">FcnDef</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">],</span>
                      <span class="n">state</span><span class="o">.</span><span class="n">avroTypeBuilder</span><span class="o">.</span><span class="n">makePlaceholder</span><span class="p">(</span><span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retType</span><span class="o">.</span><span class="n">asType</span><span class="p">(</span><span class="n">state</span><span class="p">)),</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeMemo</span><span class="p">),</span>
                      <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">definition</span><span class="p">])</span>
</div></div>
<div class="viewcode-block" id="MiniNamedFcnDef"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniNamedFcnDef">[docs]</a><span class="k">class</span> <span class="nc">MiniNamedFcnDef</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">retType</span><span class="p">,</span> <span class="n">definition</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retType</span> <span class="o">=</span> <span class="n">retType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">definition</span> <span class="o">=</span> <span class="n">definition</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniNamedFcnDef</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniNamedFcnDef({0}, {1}, {2}, {3})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)),</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retType</span><span class="p">),</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">definition</span><span class="p">)))</span>
<div class="viewcode-block" id="MiniNamedFcnDef.asFcn"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniNamedFcnDef.asFcn">[docs]</a>    <span class="k">def</span> <span class="nf">asFcn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">FcnDef</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">],</span>
                                  <span class="n">state</span><span class="o">.</span><span class="n">avroTypeBuilder</span><span class="o">.</span><span class="n">makePlaceholder</span><span class="p">(</span><span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retType</span><span class="o">.</span><span class="n">asType</span><span class="p">(</span><span class="n">state</span><span class="p">)),</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeMemo</span><span class="p">),</span>
                                  <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">definition</span><span class="p">]))</span>
</div></div>
<div class="viewcode-block" id="MiniCellPool"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniCellPool">[docs]</a><span class="k">class</span> <span class="nc">MiniCellPool</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">objType</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">rollback</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objType</span> <span class="o">=</span> <span class="n">objType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shared</span> <span class="o">=</span> <span class="n">shared</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rollback</span> <span class="o">=</span> <span class="n">rollback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniCellPool</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniCellPool({0}, {1}, {2}, {3}, {4}, {5})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">objType</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rollback</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
<div class="viewcode-block" id="MiniCellPool.asCell"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniCellPool.asCell">[docs]</a>    <span class="k">def</span> <span class="nf">asCell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Cell</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">avroTypeBuilder</span><span class="o">.</span><span class="n">makePlaceholder</span><span class="p">(</span><span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objType</span><span class="o">.</span><span class="n">asType</span><span class="p">(</span><span class="n">state</span><span class="p">)),</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeMemo</span><span class="p">),</span>
                                <span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">asJson</span><span class="p">()),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">rollback</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span></div>
<div class="viewcode-block" id="MiniCellPool.asPool"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniCellPool.asPool">[docs]</a>    <span class="k">def</span> <span class="nf">asPool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">asJson</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;pool&#39;s init must be a JSON object, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Pool</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">avroTypeBuilder</span><span class="o">.</span><span class="n">makePlaceholder</span><span class="p">(</span><span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objType</span><span class="o">.</span><span class="n">asType</span><span class="p">(</span><span class="n">state</span><span class="p">)),</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeMemo</span><span class="p">),</span>
                                <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">init</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">shared</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">rollback</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
</div></div>
<div class="viewcode-block" id="MiniIf"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniIf">[docs]</a><span class="k">class</span> <span class="nc">MiniIf</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pairs</span><span class="p">,</span> <span class="n">elseClause</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span> <span class="o">=</span> <span class="n">pairs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span> <span class="o">=</span> <span class="n">elseClause</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniIf</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniIf({0}, {1})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="p">)</span>
<div class="viewcode-block" id="MiniIf.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniIf.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">pairs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">thenClause</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thenClause</span><span class="p">,</span> <span class="n">MiniCall</span><span class="p">)</span> <span class="ow">and</span> <span class="n">thenClause</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;do&quot;</span><span class="p">:</span>
                <span class="n">thenClause</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">thenClause</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">thenClause</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">thenClause</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">thenClause</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thenClause</span> <span class="o">=</span> <span class="p">[</span><span class="n">thenClause</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span>
            <span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">If</span><span class="p">(</span><span class="n">predicate</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">),</span> <span class="n">thenClause</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">elseClause</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="p">,</span> <span class="n">MiniCall</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;do&quot;</span><span class="p">:</span>
            <span class="n">elseClause</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">elseClause</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elseClause</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">elseClause</span> <span class="o">=</span> <span class="n">elseClause</span>
            <span class="k">return</span> <span class="n">pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Cond</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">elseClause</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="MiniAsBlock"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniAsBlock">[docs]</a><span class="k">class</span> <span class="nc">MiniAsBlock</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">astype</span><span class="p">,</span> <span class="n">named</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">astype</span> <span class="o">=</span> <span class="n">astype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">named</span> <span class="o">=</span> <span class="n">named</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">body</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniAsBlock</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniAsBlock({0}, {1}, {2})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">astype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">named</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
<div class="viewcode-block" id="MiniAsBlock.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniAsBlock.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeBuilder</span><span class="o">.</span><span class="n">makePlaceholder</span><span class="p">(</span><span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">astype</span><span class="o">.</span><span class="n">asType</span><span class="p">(</span><span class="n">state</span><span class="p">)),</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeMemo</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">MiniCall</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;do&quot;</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">CastCase</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">named</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="MiniCast"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniCast">[docs]</a><span class="k">class</span> <span class="nc">MiniCast</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">asblocks</span><span class="p">,</span> <span class="n">partial</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expression</span> <span class="o">=</span> <span class="n">expression</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">asblocks</span> <span class="o">=</span> <span class="n">asblocks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partial</span> <span class="o">=</span> <span class="n">partial</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniCast</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniCast({0}, {1}, {2})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">asblocks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">)</span>
<div class="viewcode-block" id="MiniCast.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniCast.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CastBlock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">),</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">asblocks</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">partial</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="MiniIfNotNull"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniIfNotNull">[docs]</a><span class="k">class</span> <span class="nc">MiniIfNotNull</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">thenClause</span><span class="p">,</span> <span class="n">elseClause</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thenClause</span> <span class="o">=</span> <span class="n">thenClause</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span> <span class="o">=</span> <span class="n">elseClause</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniIfNotNull</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniIfNotNull({0}, {1}, {2})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thenClause</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="p">)</span>
<div class="viewcode-block" id="MiniIfNotNull.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniIfNotNull.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">typeExpr</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thenClause</span><span class="p">,</span> <span class="n">MiniCall</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">thenClause</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;do&quot;</span><span class="p">:</span>
            <span class="n">thenClause</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">thenClause</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thenClause</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">thenClause</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">thenClause</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thenClause</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">thenClause</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">elseClause</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="p">,</span> <span class="n">MiniCall</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;do&quot;</span><span class="p">:</span>
            <span class="n">elseClause</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">elseClause</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elseClause</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">IfNotNull</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">thenClause</span><span class="p">,</span> <span class="n">elseClause</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="MiniUnpack"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniUnpack">[docs]</a><span class="k">class</span> <span class="nc">MiniUnpack</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bytesExpr</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">thenClause</span><span class="p">,</span> <span class="n">elseClause</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bytesExpr</span> <span class="o">=</span> <span class="n">bytesExpr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thenClause</span> <span class="o">=</span> <span class="n">thenClause</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span> <span class="o">=</span> <span class="n">elseClause</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniUnpack</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniUnpack({0}, {1}, {2}, {3})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bytesExpr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thenClause</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="p">)</span>
<div class="viewcode-block" id="MiniUnpack.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniUnpack.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">bytesExpr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bytesExpr</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">typeExpr</span><span class="p">,</span> <span class="n">MiniDotName</span><span class="p">):</span>
                <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">typeExpr</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">typeExpr</span><span class="p">,</span> <span class="n">MiniString</span><span class="p">):</span>
                <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">typeExpr</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;unpack formatters must all be strings, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">typeExpr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thenClause</span><span class="p">,</span> <span class="n">MiniCall</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">thenClause</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;do&quot;</span><span class="p">:</span>
            <span class="n">thenClause</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">thenClause</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thenClause</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">thenClause</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">thenClause</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">thenClause</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">thenClause</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">elseClause</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="p">,</span> <span class="n">MiniCall</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;do&quot;</span><span class="p">:</span>
            <span class="n">elseClause</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">elseClause</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elseClause</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elseClause</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">Unpack</span><span class="p">(</span><span class="n">bytesExpr</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">thenClause</span><span class="p">,</span> <span class="n">elseClause</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="MiniWhile"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniWhile">[docs]</a><span class="k">class</span> <span class="nc">MiniWhile</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">pretest</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predicate</span> <span class="o">=</span> <span class="n">predicate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pretest</span> <span class="o">=</span> <span class="n">pretest</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniWhile</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniWhile({0}, {1}, {2})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predicate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretest</span><span class="p">)</span>
<div class="viewcode-block" id="MiniWhile.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniWhile.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">MiniCall</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;do&quot;</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretest</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">While</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predicate</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">),</span> <span class="n">body</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DoUntil</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicate</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="MiniFor"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniFor">[docs]</a><span class="k">class</span> <span class="nc">MiniFor</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predicate</span> <span class="o">=</span> <span class="n">predicate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">body</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniFor</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniFor({0}, {1}, {2}, {3})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predicate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
<div class="viewcode-block" id="MiniFor.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniFor.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">MiniCall</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;do&quot;</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">For</span><span class="p">(</span><span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">pairs</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">predicate</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">),</span>
                   <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">pairs</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
                   <span class="n">body</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="MiniForeach"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniForeach">[docs]</a><span class="k">class</span> <span class="nc">MiniForeach</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">seq</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniForeach</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniForeach({0}, {1}, {2})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span>
<div class="viewcode-block" id="MiniForeach.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniForeach.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">MiniCall</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;do&quot;</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">forkey</span><span class="p">,</span> <span class="n">forval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="k">return</span> <span class="n">Forkeyval</span><span class="p">(</span><span class="n">forkey</span><span class="p">,</span> <span class="n">forval</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">),</span> <span class="n">body</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Foreach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">),</span> <span class="n">body</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="MiniTry"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniTry">[docs]</a><span class="k">class</span> <span class="nc">MiniTry</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniTry</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniTry({0}, {1})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span>
<div class="viewcode-block" id="MiniTry.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniTry.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">MiniDotName</span><span class="p">,</span> <span class="n">MiniString</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;try filters must all be strings, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MiniDotName</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">MiniCall</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;do&quot;</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">Try</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="MiniGenAssignment"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniGenAssignment">[docs]</a><span class="k">class</span> <span class="nc">MiniGenAssignment</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">rhs</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rhs</span> <span class="o">=</span> <span class="n">rhs</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniGenAssignment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniGenAssignment({0}, {1}, {2})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span>
<div class="viewcode-block" id="MiniGenAssignment.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniGenAssignment.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">AttrTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">),</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="MiniAssignment"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniAssignment">[docs]</a><span class="k">class</span> <span class="nc">MiniAssignment</span><span class="p">(</span><span class="n">MiniAst</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pairs</span><span class="p">,</span> <span class="n">qualifier</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span> <span class="o">=</span> <span class="n">pairs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qualifier</span> <span class="o">=</span> <span class="n">qualifier</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MiniAssignment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;MiniAssignment({0}, {1})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifier</span><span class="p">)</span>
<div class="viewcode-block" id="MiniAssignment.asExpr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniAssignment.asExpr">[docs]</a>    <span class="k">def</span> <span class="nf">asExpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifier</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="s">&quot;.&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">pieces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">base</span> <span class="o">=</span> <span class="n">pieces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">LiteralString</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pieces</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>

            <span class="n">to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">FcnRef</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;direct assignments (with an = sign) cannot refer to functions, such as {0} at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">FcnDef</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;direct assignments (with an = sign) cannot refer to functions, such as {0} at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">cellNames</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CellTo</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">poolNames</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">PoolTo</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">AttrTo</span><span class="p">(</span><span class="n">Ref</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">),</span> <span class="n">path</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifier</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">to</span><span class="p">),</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            
            <span class="n">to</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">FcnRef</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;direct assignments (with an = sign) cannot refer to functions, such as {0} at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">FcnDef</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;direct assignments (with an = sign) cannot refer to functions, such as {0} at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">to</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">cellNames</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">CellTo</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[],</span> <span class="n">to</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">poolNames</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">PoolTo</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[],</span> <span class="n">to</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">SetVar</span><span class="p">({</span><span class="n">name</span><span class="p">:</span> <span class="n">to</span><span class="p">},</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;cannot assign multiple deep objects (name contains dots) at the same time; separate with semicolons, rather than commas, at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifier</span> <span class="o">==</span> <span class="s">&quot;var&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Let</span><span class="p">(</span><span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SetVar</span><span class="p">(</span><span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MiniAssignment.defType"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.MiniAssignment.defType">[docs]</a>    <span class="k">def</span> <span class="nf">defType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifier</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">typeExpr</span><span class="p">),</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="n">jsonNode</span> <span class="o">=</span> <span class="n">typeExpr</span><span class="o">.</span><span class="n">asType</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="n">state</span><span class="o">.</span><span class="n">avroTypeAlias</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">jsonNode</span>
            <span class="n">state</span><span class="o">.</span><span class="n">avroTypeBuilder</span><span class="o">.</span><span class="n">makePlaceholder</span><span class="p">(</span><span class="n">jsonlib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">jsonNode</span><span class="p">),</span> <span class="n">state</span><span class="o">.</span><span class="n">avroTypeMemo</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">MiniAssignment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">defType</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="Parser"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Parser">[docs]</a><span class="k">class</span> <span class="nc">Parser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wholeDocument</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wholeDocument</span> <span class="o">=</span> <span class="n">wholeDocument</span>

<div class="viewcode-block" id="Parser.initialize"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Parser.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lex</span><span class="p">,</span> <span class="n">yacc</span><span class="p">):</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;NUMBER&quot;</span><span class="p">,</span> <span class="s">&quot;STRING&quot;</span><span class="p">,</span> <span class="s">&quot;RAWSTRING&quot;</span><span class="p">,</span> <span class="s">&quot;REPLACEMENT&quot;</span><span class="p">,</span> <span class="s">&quot;DOTNAME&quot;</span><span class="p">,</span>
                  <span class="s">&quot;LPAREN&quot;</span><span class="p">,</span> <span class="s">&quot;RPAREN&quot;</span><span class="p">,</span> <span class="s">&quot;LBRACKET&quot;</span><span class="p">,</span> <span class="s">&quot;RBRACKET&quot;</span><span class="p">,</span> <span class="s">&quot;LCURLY&quot;</span><span class="p">,</span> <span class="s">&quot;RCURLY&quot;</span><span class="p">,</span> <span class="s">&quot;RARROW&quot;</span><span class="p">,</span> 
                  <span class="s">&quot;PLUS&quot;</span><span class="p">,</span> <span class="s">&quot;MINUS&quot;</span><span class="p">,</span> <span class="s">&quot;TIMES&quot;</span><span class="p">,</span> <span class="s">&quot;FDIV&quot;</span><span class="p">,</span> <span class="s">&quot;MOD&quot;</span><span class="p">,</span> <span class="s">&quot;REM&quot;</span><span class="p">,</span> <span class="s">&quot;POW&quot;</span><span class="p">,</span> <span class="s">&quot;EQ&quot;</span><span class="p">,</span> <span class="s">&quot;NE&quot;</span><span class="p">,</span> <span class="s">&quot;LT&quot;</span><span class="p">,</span> <span class="s">&quot;LE&quot;</span><span class="p">,</span> <span class="s">&quot;GT&quot;</span><span class="p">,</span> <span class="s">&quot;GE&quot;</span><span class="p">,</span> <span class="s">&quot;AND&quot;</span><span class="p">,</span> <span class="s">&quot;OR&quot;</span><span class="p">,</span> <span class="s">&quot;XOR&quot;</span><span class="p">,</span> <span class="s">&quot;NOT&quot;</span><span class="p">,</span> <span class="s">&quot;BITAND&quot;</span><span class="p">,</span> <span class="s">&quot;BITOR&quot;</span><span class="p">,</span> <span class="s">&quot;BITXOR&quot;</span><span class="p">,</span> <span class="s">&quot;BITNOT&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wholeDocument</span><span class="p">:</span>
            <span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;SECTION_HEADER_START&quot;</span><span class="p">)</span>
            <span class="n">tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;SECTION_HEADER&quot;</span><span class="p">)</span>
                  
        <span class="n">reserved</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;idiv&quot;</span><span class="p">:</span> <span class="s">&quot;IDIV&quot;</span><span class="p">,</span>
                    <span class="s">&quot;fcn&quot;</span><span class="p">:</span> <span class="s">&quot;FCN&quot;</span><span class="p">,</span>
                    <span class="s">&quot;if&quot;</span><span class="p">:</span> <span class="s">&quot;IF&quot;</span><span class="p">,</span>
                    <span class="s">&quot;else&quot;</span><span class="p">:</span> <span class="s">&quot;ELSE&quot;</span><span class="p">,</span>
                    <span class="s">&quot;while&quot;</span><span class="p">:</span> <span class="s">&quot;WHILE&quot;</span><span class="p">,</span>
                    <span class="s">&quot;do&quot;</span><span class="p">:</span> <span class="s">&quot;DO&quot;</span><span class="p">,</span>
                    <span class="s">&quot;until&quot;</span><span class="p">:</span> <span class="s">&quot;UNTIL&quot;</span><span class="p">,</span>
                    <span class="s">&quot;for&quot;</span><span class="p">:</span> <span class="s">&quot;FOR&quot;</span><span class="p">,</span>
                    <span class="s">&quot;foreach&quot;</span><span class="p">:</span> <span class="s">&quot;FOREACH&quot;</span><span class="p">,</span>
                    <span class="s">&quot;cast&quot;</span><span class="p">:</span> <span class="s">&quot;CAST&quot;</span><span class="p">,</span>
                    <span class="s">&quot;as&quot;</span><span class="p">:</span> <span class="s">&quot;AS&quot;</span><span class="p">,</span>
                    <span class="s">&quot;ifnotnull&quot;</span><span class="p">:</span> <span class="s">&quot;IFNOTNULL&quot;</span><span class="p">,</span>
                    <span class="s">&quot;unpack&quot;</span><span class="p">:</span> <span class="s">&quot;UNPACK&quot;</span><span class="p">,</span>
                    <span class="s">&quot;try&quot;</span><span class="p">:</span> <span class="s">&quot;TRY&quot;</span><span class="p">,</span>
                    <span class="s">&quot;var&quot;</span><span class="p">:</span> <span class="s">&quot;VAR&quot;</span><span class="p">,</span>
                    <span class="s">&quot;to&quot;</span><span class="p">:</span> <span class="s">&quot;TO&quot;</span><span class="p">,</span>
                    <span class="s">&quot;init&quot;</span><span class="p">:</span> <span class="s">&quot;INIT&quot;</span><span class="p">}</span>
        <span class="n">tokens</span> <span class="o">+=</span> <span class="n">reserved</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

        <span class="n">literals</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;,&quot;</span><span class="p">,</span> <span class="s">&quot;;&quot;</span><span class="p">,</span> <span class="s">&quot;:&quot;</span><span class="p">,</span> <span class="s">&quot;=&quot;</span><span class="p">,</span> <span class="s">&quot;@&quot;</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">insertArrow</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">which</span><span class="p">):</span>
            <span class="n">lines</span><span class="p">[</span><span class="n">which</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">which</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;     &lt;----&quot;</span>
            <span class="k">return</span> <span class="n">lines</span>

        <span class="k">def</span> <span class="nf">t_COMMENT</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;//.*&quot;</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wholeDocument</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">t_SECTION_HEADER_START</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                <span class="s">r&quot;^[a-z]+:&quot;</span>
                <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;SECTION_HEADER_START&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">t</span>

            <span class="k">def</span> <span class="nf">t_SECTION_HEADER</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                <span class="s">r&quot;(\r\n?|\n)+[a-z]+:&quot;</span>
                <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(\r\n?|\n)&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
                <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;SECTION_HEADER&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_DOTNAME</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;[A-Za-z_][A-Za-z_0-9]*(\.[A-Za-z_][A-Za-z_0-9]*)*&quot;</span>
            <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="n">reserved</span><span class="p">:</span>
                <span class="n">t</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">reserved</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
                <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;DOTNAME&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_NUMBER</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;-?(0|[1-9][0-9]*)(\.[0-9]*)?([eE][-+]?[0-9]+)?&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;NUMBER&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;NUMBER&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_STRING</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&#39;\&quot;([^</span><span class="se">\\</span><span class="s">\n]|(</span><span class="se">\\</span><span class="s">.))*?\&quot;&#39;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;STRING&quot;</span><span class="p">,</span> <span class="n">pythonast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_RAWSTRING</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;&#39;[^&#39;]*&#39;&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;RAWSTRING&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_REPLACEMENT</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;&lt;&lt;[A-Za-z_][A-Za-z_0-9]*&gt;&gt;&quot;</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subs</span><span class="p">:</span>
                <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">ResolvedSubs</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subs</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Subs</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_RARROW</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;-&gt;&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;RARROW&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_LPAREN</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;\(&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;LPAREN&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_RPAREN</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;\)&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;RPAREN&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_LBRACKET</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;\[&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;LBRACKET&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_RBRACKET</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;\]&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;RBRACKET&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_LCURLY</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;\{&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;LCURLY&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_RCURLY</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;\}&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;RCURLY&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_PLUS</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;\+&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;PLUS&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_MINUS</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;-&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;MINUS&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_POW</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;\*\*&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;POW&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_TIMES</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;\*&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;TIMES&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_FDIV</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;/&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;FDIV&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_REM</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;</span><span class="si">%%</span><span class="s">&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;REM&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_MOD</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;%&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;MOD&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_EQ</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;==&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;EQ&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_NE</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;!=&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;NE&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_LE</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;&lt;=&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;LE&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_LT</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;&lt;&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;LT&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_GE</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;&gt;=&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;GE&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_GT</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;&gt;&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;GT&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_AND</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;&amp;&amp;&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;AND&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_OR</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;\|\|&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;OR&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_XOR</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;\^\^&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;XOR&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_NOT</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;!&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;NOT&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_BITAND</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;&amp;&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;BITAND&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_BITOR</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;\|&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;BITOR&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_BITXOR</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;\^&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;BITXOR&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">t_BITNOT</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;~&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">Token</span><span class="p">(</span><span class="s">&quot;BITNOT&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="n">t_ignore</span> <span class="o">=</span> <span class="s">&quot; </span><span class="se">\t</span><span class="s">&quot;</span>

        <span class="k">def</span> <span class="nf">t_newline</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="s">r&quot;(\r\n?|\n)+&quot;</span>
            <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;(\r\n?|\n)&quot;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">t_error</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="n">lineno</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;Tokenizing syntax error: </span><span class="se">\&quot;</span><span class="s">{0}</span><span class="se">\&quot;</span><span class="s"> at PrettyPFA line {1}: {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lineno</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">offendingLine</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">insertArrow</span><span class="p">(</span><span class="n">lines</span><span class="p">[(</span><span class="n">lineno</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):(</span><span class="n">lineno</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)],</span> <span class="mi">1</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;Tokenizing syntax error: </span><span class="se">\&quot;</span><span class="s">{0}</span><span class="se">\&quot;</span><span class="s"> at PrettyPFA line {1}:</span><span class="se">\n</span><span class="s">{2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">offendingLine</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lexer</span> <span class="o">=</span> <span class="n">lex</span><span class="o">.</span><span class="n">lex</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wholeDocument</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">p_document</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="sd">r&#39;&#39;&#39;document : sections&#39;&#39;&#39;</span>

                <span class="n">sectionDict</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">sectionDict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

                <span class="n">_name</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">_method</span> <span class="o">=</span> <span class="n">Method</span><span class="o">.</span><span class="n">MAP</span>
                <span class="n">_input</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">_output</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">_begin</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">_action</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">_end</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">_fcns</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">_zero</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">_merge</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">_cells</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">_pools</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">_randseed</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">_doc</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">_version</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">_metadata</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">_options</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">if</span> <span class="s">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">_name</span> <span class="o">=</span> <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_name</span> <span class="o">=</span> <span class="n">titus</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">uniqueEngineName</span><span class="p">()</span>

                <span class="k">if</span> <span class="s">&quot;method&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">_method</span> <span class="o">=</span> <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;method&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">method</span><span class="p">()</span>

                <span class="n">state</span> <span class="o">=</span> <span class="n">InterpretationState</span><span class="p">()</span>

                <span class="k">if</span> <span class="s">&quot;types&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;types&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">types</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

                <span class="k">if</span> <span class="s">&quot;input&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">_input</span> <span class="o">=</span> <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;input&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&quot;output&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">_output</span> <span class="o">=</span> <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;output&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&quot;cells&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">_cells</span> <span class="o">=</span> <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;cells&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cells</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&quot;pools&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">_pools</span> <span class="o">=</span> <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;pools&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pools</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

                <span class="k">if</span> <span class="s">&quot;fcns&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;fcns&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MiniNamedFcnDef</span><span class="p">):</span>
                            <span class="n">state</span><span class="o">.</span><span class="n">functionNames</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;u.&quot;</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">state</span><span class="o">.</span><span class="n">cellNames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">_cells</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">state</span><span class="o">.</span><span class="n">poolNames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">_pools</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

                <span class="k">if</span> <span class="s">&quot;begin&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">_begin</span> <span class="o">=</span> <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;begin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">begin</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&quot;action&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">_action</span> <span class="o">=</span> <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;action&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&quot;end&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">_end</span> <span class="o">=</span> <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;end&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&quot;fcns&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">_fcns</span> <span class="o">=</span> <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;fcns&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fcns</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

                <span class="k">if</span> <span class="s">&quot;zero&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">_zero</span> <span class="o">=</span> <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;zero&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span>
                <span class="k">if</span> <span class="s">&quot;merge&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">_merge</span> <span class="o">=</span> <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;merge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&quot;randseed&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">_randseed</span> <span class="o">=</span> <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;randseed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">randseed</span><span class="p">()</span>
                <span class="k">if</span> <span class="s">&quot;doc&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">_doc</span> <span class="o">=</span> <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;doc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">doc</span><span class="p">()</span>
                <span class="k">if</span> <span class="s">&quot;version&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">_version</span> <span class="o">=</span> <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;version&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">version</span><span class="p">()</span>
                <span class="k">if</span> <span class="s">&quot;metadata&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">_metadata</span> <span class="o">=</span> <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;metadata&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">metadata</span><span class="p">()</span>
                <span class="k">if</span> <span class="s">&quot;options&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="n">_options</span> <span class="o">=</span> <span class="n">sectionDict</span><span class="p">[</span><span class="s">&quot;options&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">options</span><span class="p">()</span>

                <span class="n">required</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s">&quot;action&quot;</span><span class="p">,</span> <span class="s">&quot;input&quot;</span><span class="p">,</span> <span class="s">&quot;output&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">keys</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">required</span><span class="p">)</span> <span class="o">!=</span> <span class="n">required</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PFASyntaxException</span><span class="p">(</span><span class="s">&quot;missing top-level fields: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">required</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">keys</span><span class="p">))),</span> <span class="s">&quot;PrettyPFA document&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">EngineConfig</span><span class="p">(</span><span class="n">_name</span><span class="p">,</span> <span class="n">_method</span><span class="p">,</span> <span class="n">_input</span><span class="p">,</span> <span class="n">_output</span><span class="p">,</span> <span class="n">_begin</span><span class="p">,</span> <span class="n">_action</span><span class="p">,</span> <span class="n">_end</span><span class="p">,</span> <span class="n">_fcns</span><span class="p">,</span> <span class="n">_zero</span><span class="p">,</span> <span class="n">_merge</span><span class="p">,</span> <span class="n">_cells</span><span class="p">,</span> <span class="n">_pools</span><span class="p">,</span> <span class="n">_randseed</span><span class="p">,</span> <span class="n">_doc</span><span class="p">,</span> <span class="n">_version</span><span class="p">,</span> <span class="n">_metadata</span><span class="p">,</span> <span class="n">_options</span><span class="p">,</span> <span class="s">&quot;PrettyPFA document&quot;</span><span class="p">)</span>
                    <span class="n">state</span><span class="o">.</span><span class="n">avroTypeBuilder</span><span class="o">.</span><span class="n">resolveTypes</span><span class="p">()</span>
                    
            <span class="k">def</span> <span class="nf">p_section</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="sd">r&#39;&#39;&#39;section : SECTION_HEADER_START anything</span>
<span class="sd">                            | SECTION_HEADER anything&#39;&#39;&#39;</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Section</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">def</span> <span class="nf">p_sections</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="sd">r&#39;&#39;&#39;sections : section</span>
<span class="sd">                             | sections section&#39;&#39;&#39;</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]})</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">def</span> <span class="nf">p_anything</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="sd">r&#39;&#39;&#39;anything : expression</span>
<span class="sd">                             | expressions</span>
<span class="sd">                             | bracketedargs</span>
<span class="sd">                             | namedfcndefs</span>
<span class="sd">                             | cellpools&#39;&#39;&#39;</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">p_expressions</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expressions : expression</span>
<span class="sd">                            | expressions &quot;;&quot; expression&#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">p_expressions_extrasemi</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expressions : expressions &quot;;&quot;&#39;&#39;&#39;</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">p_block</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;block : LCURLY expressions RCURLY</span>
<span class="sd">                      | LCURLY parameters RCURLY&#39;&#39;&#39;</span>
            <span class="n">lcurly</span><span class="p">,</span> <span class="n">exprs</span><span class="p">,</span> <span class="n">rcurly</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniBlock</span><span class="p">(</span><span class="n">exprs</span><span class="p">,</span> <span class="n">lcurly</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">rcurly</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_bracketedargs</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;bracketedargs : LBRACKET arguments RBRACKET&#39;&#39;&#39;</span>
            <span class="n">lbracket</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">rbracket</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniBracketedArgs</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">lbracket</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">rbracket</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_argument</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;argument : expression</span>
<span class="sd">                         | parameter</span>
<span class="sd">                         | bracketedargs</span>
<span class="sd">                         | fcndef&#39;&#39;&#39;</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">p_arguments</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;arguments : empty</span>
<span class="sd">                          | argument</span>
<span class="sd">                          | arguments &quot;,&quot; argument&#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">p_parameters</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;parameters : empty</span>
<span class="sd">                           | parameter</span>
<span class="sd">                           | parameters &quot;,&quot; parameter&#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">p_parameter</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;parameter : DOTNAME &quot;:&quot; argument</span>
<span class="sd">                          | STRING &quot;:&quot; argument</span>
<span class="sd">                          | RAWSTRING &quot;:&quot; argument&#39;&#39;&#39;</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniParam</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>

        <span class="n">precedence</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&quot;left&quot;</span><span class="p">,</span> <span class="s">&quot;OR&quot;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">,</span> <span class="s">&quot;XOR&quot;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">,</span> <span class="s">&quot;AND&quot;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">,</span> <span class="s">&quot;NOT&quot;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s">&quot;nonassoc&quot;</span><span class="p">,</span> <span class="s">&quot;EQ&quot;</span><span class="p">,</span> <span class="s">&quot;NE&quot;</span><span class="p">,</span> <span class="s">&quot;LT&quot;</span><span class="p">,</span> <span class="s">&quot;LE&quot;</span><span class="p">,</span> <span class="s">&quot;GT&quot;</span><span class="p">,</span> <span class="s">&quot;GE&quot;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">,</span> <span class="s">&quot;BITOR&quot;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">,</span> <span class="s">&quot;BITXOR&quot;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">,</span> <span class="s">&quot;BITAND&quot;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">,</span> <span class="s">&quot;PLUS&quot;</span><span class="p">,</span> <span class="s">&quot;MINUS&quot;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">,</span> <span class="s">&quot;TIMES&quot;</span><span class="p">,</span> <span class="s">&quot;FDIV&quot;</span><span class="p">,</span> <span class="s">&quot;IDIV&quot;</span><span class="p">,</span> <span class="s">&quot;MOD&quot;</span><span class="p">,</span> <span class="s">&quot;REM&quot;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">,</span> <span class="s">&quot;UMINUS&quot;</span><span class="p">,</span> <span class="s">&quot;BITNOT&quot;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">,</span> <span class="s">&quot;POW&quot;</span><span class="p">)]</span>

        <span class="k">def</span> <span class="nf">p_expression_replacement</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : REPLACEMENT&#39;&#39;&#39;</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">p_expression_call</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : DOTNAME LPAREN arguments RPAREN&#39;&#39;&#39;</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">arguments</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_expression_uminus</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : MINUS expression %prec UMINUS&#39;&#39;&#39;</span>
            <span class="n">op</span><span class="p">,</span> <span class="n">expr</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;u-&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">expr</span><span class="p">],</span> <span class="n">op</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_expression_bitnot</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : BITNOT expression&#39;&#39;&#39;</span>
            <span class="n">op</span><span class="p">,</span> <span class="n">expr</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;~&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">expr</span><span class="p">],</span> <span class="n">op</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_expression_not</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : NOT expression&#39;&#39;&#39;</span>
            <span class="n">op</span><span class="p">,</span> <span class="n">expr</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;!&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">expr</span><span class="p">],</span> <span class="n">op</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_expression_binop</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : expression OR expression</span>
<span class="sd">                           | expression XOR expression</span>
<span class="sd">                           | expression AND expression</span>
<span class="sd">                           | expression EQ expression</span>
<span class="sd">                           | expression NE expression</span>
<span class="sd">                           | expression LT expression</span>
<span class="sd">                           | expression LE expression</span>
<span class="sd">                           | expression GT expression</span>
<span class="sd">                           | expression GE expression</span>
<span class="sd">                           | expression BITOR expression</span>
<span class="sd">                           | expression BITXOR expression</span>
<span class="sd">                           | expression BITAND expression</span>
<span class="sd">                           | expression PLUS expression</span>
<span class="sd">                           | expression MINUS expression</span>
<span class="sd">                           | expression TIMES expression</span>
<span class="sd">                           | expression FDIV expression</span>
<span class="sd">                           | expression IDIV expression</span>
<span class="sd">                           | expression MOD expression</span>
<span class="sd">                           | expression REM expression</span>
<span class="sd">                           | expression POW expression&#39;&#39;&#39;</span>
            <span class="n">left</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;OR&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;||&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;XOR&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;^^&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;AND&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;&amp;&amp;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;EQ&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;==&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;NE&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;!=&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;LT&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;&lt;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;LE&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;&lt;=&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;GT&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;&gt;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;GE&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;&gt;=&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;BITOR&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;|&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;BITXOR&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;^&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;BITAND&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;&amp;&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;PLUS&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;+&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;MINUS&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;TIMES&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;FDIV&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;IDIV&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;//&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;MOD&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;%&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;REM&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%%</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">op</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;POW&quot;</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;**&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_expression_group</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : LPAREN expression RPAREN&#39;&#39;&#39;</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">p_rettype</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;rettype : RARROW expression&#39;&#39;&#39;</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">p_fcndef</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;fcndef : FCN LPAREN parameters rettype RPAREN expression</span>
<span class="sd">                       | FCN LPAREN parameters rettype RPAREN block&#39;&#39;&#39;</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">retType</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">definition</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">definition</span><span class="p">,</span> <span class="n">MiniBlock</span><span class="p">):</span>
                <span class="n">definition</span> <span class="o">=</span> <span class="n">definition</span><span class="o">.</span><span class="n">exprs</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">definition</span> <span class="o">=</span> <span class="p">[</span><span class="n">definition</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">high</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">high</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">high</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">high</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">high</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniFcnDef</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">retType</span><span class="p">,</span> <span class="n">definition</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wholeDocument</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">p_namedfcndef</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="sd">r&#39;&#39;&#39;namedfcndef : DOTNAME &quot;=&quot; FCN LPAREN parameters rettype RPAREN expression</span>
<span class="sd">                                | DOTNAME &quot;=&quot; FCN LPAREN parameters rettype RPAREN block&#39;&#39;&#39;</span>
                <span class="n">parameters</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="n">retType</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                <span class="n">definition</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">definition</span><span class="p">,</span> <span class="n">MiniBlock</span><span class="p">):</span>
                    <span class="n">definition</span> <span class="o">=</span> <span class="n">definition</span><span class="o">.</span><span class="n">exprs</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">definition</span> <span class="o">=</span> <span class="p">[</span><span class="n">definition</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">high</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">high</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">high</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">high</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">high</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniNamedFcnDef</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">retType</span><span class="p">,</span> <span class="n">definition</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">p_namedfcndefs</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="sd">r&#39;&#39;&#39;namedfcndefs : empty</span>
<span class="sd">                                 | namedfcndef</span>
<span class="sd">                                 | namedfcndefs &quot;;&quot; namedfcndef&#39;&#39;&#39;</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">def</span> <span class="nf">p_namedfcndefs_extrasemi</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="sd">r&#39;&#39;&#39;namedfcndefs : namedfcndefs &quot;;&quot;&#39;&#39;&#39;</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">def</span> <span class="nf">p_cellpool</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="sd">r&#39;&#39;&#39;cellpool : DOTNAME LPAREN arguments RPAREN &quot;=&quot; block</span>
<span class="sd">                             | DOTNAME LPAREN arguments RPAREN &quot;=&quot; bracketedargs</span>
<span class="sd">                             | DOTNAME LPAREN arguments RPAREN &quot;=&quot; NUMBER</span>
<span class="sd">                             | DOTNAME LPAREN arguments RPAREN &quot;=&quot; STRING</span>
<span class="sd">                             | DOTNAME LPAREN arguments RPAREN &quot;=&quot; RAWSTRING</span>
<span class="sd">                             | DOTNAME LPAREN arguments RPAREN &quot;=&quot; DOTNAME</span>
<span class="sd">                             | DOTNAME LPAREN arguments RPAREN &quot;=&quot; REPLACEMENT&#39;&#39;&#39;</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">v</span>
                <span class="n">token</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="p">(</span><span class="n">Subs</span><span class="p">,</span> <span class="n">ResolvedSubs</span><span class="p">)):</span>
                    <span class="n">init</span> <span class="o">=</span> <span class="n">token</span>
                    <span class="n">high</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">lineno</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">Token</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;NUMBER&quot;</span><span class="p">:</span>
                        <span class="n">init</span> <span class="o">=</span> <span class="n">MiniNumber</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;STRING&quot;</span><span class="p">:</span>
                        <span class="n">init</span> <span class="o">=</span> <span class="n">MiniString</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;RAWSTRING&quot;</span><span class="p">:</span>
                        <span class="n">init</span> <span class="o">=</span> <span class="n">MiniString</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;DOTNAME&quot;</span><span class="p">:</span>
                        <span class="n">init</span> <span class="o">=</span> <span class="n">MiniDotName</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
                    <span class="n">high</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">lineno</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">init</span> <span class="o">=</span> <span class="n">token</span>
                    <span class="n">high</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">high</span>

                <span class="n">shared</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">rollback</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">source</span> <span class="o">=</span> <span class="s">&quot;embedded&quot;</span>
                <span class="n">objType</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">others</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">MiniParam</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;shared&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">typeExpr</span> <span class="o">==</span> <span class="n">MiniDotName</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
                                <span class="n">shared</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">typeExpr</span> <span class="o">==</span> <span class="n">MiniDotName</span><span class="p">(</span><span class="s">&quot;false&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
                                <span class="n">shared</span> <span class="o">=</span> <span class="bp">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;cell/pool parameter </span><span class="se">\&quot;</span><span class="s">shared</span><span class="se">\&quot;</span><span class="s"> must be boolean, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">typeExpr</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
                        <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;rollback&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">typeExpr</span> <span class="o">==</span> <span class="n">MiniDotName</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
                                <span class="n">rollback</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">typeExpr</span> <span class="o">==</span> <span class="n">MiniDotName</span><span class="p">(</span><span class="s">&quot;false&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
                                <span class="n">rollback</span> <span class="o">=</span> <span class="bp">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;cell/pool parameter </span><span class="se">\&quot;</span><span class="s">rollback</span><span class="se">\&quot;</span><span class="s"> must be true or false, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">typeExpr</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
                        <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;source&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">typeExpr</span><span class="p">,</span> <span class="n">MiniDotName</span><span class="p">):</span>
                                <span class="n">source</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">typeExpr</span><span class="o">.</span><span class="n">name</span>
                            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">typeExpr</span><span class="p">,</span> <span class="n">MiniString</span><span class="p">):</span>
                                <span class="n">source</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">typeExpr</span><span class="o">.</span><span class="n">value</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;cell/pool parameter </span><span class="se">\&quot;</span><span class="s">source</span><span class="se">\&quot;</span><span class="s"> must be a string, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">typeExpr</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
                        <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;type&quot;</span><span class="p">:</span>
                            <span class="n">objType</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">typeExpr</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;only </span><span class="se">\&quot;</span><span class="s">type</span><span class="se">\&quot;</span><span class="s">, </span><span class="se">\&quot;</span><span class="s">shared</span><span class="se">\&quot;</span><span class="s">, and </span><span class="se">\&quot;</span><span class="s">rollback</span><span class="se">\&quot;</span><span class="s"> are recognized as cell/pool parameters&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">others</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">objType</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">others</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">objType</span> <span class="o">=</span> <span class="n">others</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">objType</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">others</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;only one unnamed parameter, the type, can be provided in a cell/pool declaration, and only if it is not also provided as a named parameter at PrettyPFA line {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">))</span>

                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCellPool</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">objType</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">shared</span><span class="p">,</span> <span class="n">rollback</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">p_cellpools</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="sd">r&#39;&#39;&#39;cellpools : cellpool</span>
<span class="sd">                              | cellpools &quot;;&quot; cellpool&#39;&#39;&#39;</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">def</span> <span class="nf">p_cellpools_extrasemi</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="sd">r&#39;&#39;&#39;cellpools : cellpools &quot;;&quot;&#39;&#39;&#39;</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">p_ifthen</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : IF LPAREN expression RPAREN expression</span>
<span class="sd">                           | IF LPAREN expression RPAREN expression ELSE expression&#39;&#39;&#39;</span>
            <span class="n">predicate</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">thenClause</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">elseClause</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
                <span class="n">high</span> <span class="o">=</span> <span class="n">elseClause</span><span class="o">.</span><span class="n">high</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">elseClause</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">high</span> <span class="o">=</span> <span class="n">thenClause</span><span class="o">.</span><span class="n">high</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elseClause</span><span class="p">,</span> <span class="n">MiniIf</span><span class="p">):</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniIf</span><span class="p">([(</span><span class="n">predicate</span><span class="p">,</span> <span class="n">thenClause</span><span class="p">)]</span> <span class="o">+</span> <span class="n">elseClause</span><span class="o">.</span><span class="n">pairs</span><span class="p">,</span> <span class="n">elseClause</span><span class="o">.</span><span class="n">elseClause</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniIf</span><span class="p">([(</span><span class="n">predicate</span><span class="p">,</span> <span class="n">thenClause</span><span class="p">)],</span> <span class="n">elseClause</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_whileloop</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : WHILE LPAREN expression RPAREN expression&#39;&#39;&#39;</span>
            <span class="n">predicate</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniWhile</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_doloop</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : DO expression UNTIL LPAREN expression RPAREN&#39;&#39;&#39;</span>
            <span class="n">predicate</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniWhile</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_forloop</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : FOR LPAREN assignments &quot;;&quot; expression &quot;;&quot; assignments RPAREN expression&#39;&#39;&#39;</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniFor</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_foreach</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : FOREACH LPAREN parameter RPAREN expression</span>
<span class="sd">                           | FOREACH LPAREN parameter &quot;,&quot; parameter RPAREN expression&#39;&#39;&#39;</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s">&quot;seq&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;optional second parameter in foreach must be </span><span class="se">\&quot;</span><span class="s">seq</span><span class="se">\&quot;</span><span class="s">, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span> <span class="o">==</span> <span class="n">MiniDotName</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
                    <span class="n">seq</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">elif</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span> <span class="o">==</span> <span class="n">MiniDotName</span><span class="p">(</span><span class="s">&quot;false&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
                    <span class="n">seq</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;optional second parameter in foreach must be boolean, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="n">seq</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniForeach</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_forkeyval</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : FOREACH LPAREN STRING &quot;,&quot; parameter RPAREN expression</span>
<span class="sd">                           | FOREACH LPAREN RAWSTRING &quot;,&quot; parameter RPAREN expression</span>
<span class="sd">                           | FOREACH LPAREN DOTNAME &quot;,&quot; parameter RPAREN expression&#39;&#39;&#39;</span>
            <span class="n">forkey</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">v</span>
            <span class="n">forval</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
            <span class="n">container</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniForeach</span><span class="p">((</span><span class="n">forkey</span><span class="p">,</span> <span class="n">forval</span><span class="p">),</span> <span class="n">container</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_asblock</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;asblock : AS LPAREN parameter RPAREN expression&#39;&#39;&#39;</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniAsBlock</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_asblocks</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;asblocks : asblock</span>
<span class="sd">                         | asblocks asblock&#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">p_cast</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : CAST LPAREN expression RPAREN LCURLY asblocks RCURLY</span>
<span class="sd">                           | CAST LPAREN expression &quot;,&quot; parameter RPAREN LCURLY asblocks RCURLY&#39;&#39;&#39;</span>
            <span class="n">expression</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s">&quot;partial&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;optional second parameter in cast must be </span><span class="se">\&quot;</span><span class="s">partial</span><span class="se">\&quot;</span><span class="s">, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span> <span class="o">==</span> <span class="n">MiniDotName</span><span class="p">(</span><span class="s">&quot;true&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
                    <span class="n">partial</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">elif</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span> <span class="o">==</span> <span class="n">MiniDotName</span><span class="p">(</span><span class="s">&quot;false&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
                    <span class="n">partial</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;optional second parameter in cast must be boolean, not {0}, at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">typeExpr</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">))</span>
                <span class="n">asblocks</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">asblocks</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                <span class="n">partial</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCast</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">asblocks</span><span class="p">,</span> <span class="n">partial</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">asblocks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_ifnotnull</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : IFNOTNULL LPAREN parameters RPAREN expression</span>
<span class="sd">                           | IFNOTNULL LPAREN parameters RPAREN expression ELSE expression&#39;&#39;&#39;</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">thenClause</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
                <span class="n">elseClause</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
                <span class="n">high</span> <span class="o">=</span> <span class="n">elseClause</span><span class="o">.</span><span class="n">high</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">elseClause</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">high</span> <span class="o">=</span> <span class="n">thenClause</span><span class="o">.</span><span class="n">high</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniIfNotNull</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">thenClause</span><span class="p">,</span> <span class="n">elseClause</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_unpack</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : UNPACK LPAREN expression &quot;,&quot; parameters RPAREN expression</span>
<span class="sd">                           | UNPACK LPAREN expression &quot;,&quot; parameters RPAREN expression ELSE expression&#39;&#39;&#39;</span>
            <span class="n">bytesExpr</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">thenClause</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">elseClause</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
                <span class="n">high</span> <span class="o">=</span> <span class="n">elseClause</span><span class="o">.</span><span class="n">high</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">elseClause</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">high</span> <span class="o">=</span> <span class="n">thenClause</span><span class="o">.</span><span class="n">high</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniUnpack</span><span class="p">(</span><span class="n">bytesExpr</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">thenClause</span><span class="p">,</span> <span class="n">elseClause</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_try</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : TRY expression</span>
<span class="sd">                           | TRY LPAREN expression RPAREN expression</span>
<span class="sd">                           | TRY LPAREN arguments RPAREN expression&#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">filters</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">filters</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">filters</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniTry</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_genassignment</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : expression LBRACKET arguments RBRACKET &quot;=&quot; expression&#39;&#39;&#39;</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniGenAssignment</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_assignment</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;assignment : DOTNAME &quot;=&quot; expression&#39;&#39;&#39;</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniAssignment</span><span class="p">({</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]},</span> <span class="bp">None</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_assignments</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;assignments : assignment</span>
<span class="sd">                            | assignments &quot;,&quot; assignment&#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pairs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">pairs</span><span class="p">)</span>
                <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">high</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">p_assignmentlet</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : VAR assignments&#39;&#39;&#39;</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">qualifier</span> <span class="o">=</span> <span class="s">&quot;var&quot;</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">p_assignmentset</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : assignments&#39;&#39;&#39;</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">qualifier</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">p_genextraction</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : expression LBRACKET arguments RBRACKET&#39;&#39;&#39;</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniGenGet</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_extraction</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : DOTNAME LBRACKET arguments RBRACKET&#39;&#39;&#39;</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniGet</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_deepassignment_1</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : DOTNAME LBRACKET arguments RBRACKET &quot;=&quot; expression</span>
<span class="sd">                           | DOTNAME LBRACKET arguments RBRACKET TO argument</span>
<span class="sd">                           | DOTNAME LBRACKET arguments RBRACKET TO argument INIT expression&#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">init</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
                <span class="n">high</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">high</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">init</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">high</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">high</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniTo</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;=&quot;</span><span class="p">),</span> <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">init</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_deepassignment_2</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : DOTNAME TO argument</span>
<span class="sd">                           | DOTNAME TO argument INIT expression&#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">init</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="n">high</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">high</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">init</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">high</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">high</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniTo</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="p">[],</span> <span class="bp">False</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">init</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_enumsymbol</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : DOTNAME &quot;@&quot; DOTNAME&#39;&#39;&#39;</span>
            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniEnumSymbol</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_expression_simple</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;expression : block</span>
<span class="sd">                           | NUMBER</span>
<span class="sd">                           | STRING</span>
<span class="sd">                           | RAWSTRING</span>
<span class="sd">                           | DOTNAME&#39;&#39;&#39;</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">Token</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;NUMBER&quot;</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniNumber</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;STRING&quot;</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniString</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;RAWSTRING&quot;</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniString</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">token</span><span class="o">.</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;DOTNAME&quot;</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniDotName</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MiniParam</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">exprs</span><span class="p">):</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">MiniCall</span><span class="p">(</span><span class="s">&quot;do&quot;</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">exprs</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> <span class="n">token</span><span class="o">.</span><span class="n">high</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">p_empty</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="sd">r&#39;&#39;&#39;empty : &#39;&#39;&#39;</span>

        <span class="k">def</span> <span class="nf">p_error</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;Parsing syntax error&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lineno</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">lineno</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;Parsing syntax error on line {0}: {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">offendingLine</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">insertArrow</span><span class="p">(</span><span class="n">lines</span><span class="p">[(</span><span class="n">lineno</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):(</span><span class="n">lineno</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)],</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="k">raise</span> <span class="n">PrettyPfaException</span><span class="p">(</span><span class="s">&quot;Parsing syntax error on line {0}:</span><span class="se">\n</span><span class="s">{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">lineno</span><span class="p">,</span> <span class="n">offendingLine</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">yacc</span> <span class="o">=</span> <span class="n">yacc</span><span class="o">.</span><span class="n">yacc</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">write_tables</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Parser.parse"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.Parser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">subs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lexer</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subs</span> <span class="o">=</span> <span class="n">subs</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yacc</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lexer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lexer</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wholeDocument</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">InterpretationState</span><span class="p">()</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">out</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">asExpr</span><span class="p">(</span><span class="n">InterpretationState</span><span class="p">())</span>

<span class="c">###</span>
</div></div>
<span class="n">parser</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

<div class="viewcode-block" id="subs"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.subs">[docs]</a><span class="k">def</span> <span class="nf">subs</span><span class="p">(</span><span class="n">originalAst</span><span class="p">,</span> <span class="o">**</span><span class="n">subs2</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">pf</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">subs2</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">context</span> <span class="o">==</span> <span class="s">&quot;expr&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">ppfa</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">Ast</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">pfa</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="n">pf</span><span class="o">.</span><span class="n">isDefinedAt</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">Subs</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">subs2</span>
    <span class="k">return</span> <span class="n">originalAst</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">pf</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ast"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.ast">[docs]</a><span class="k">def</span> <span class="nf">ast</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">subs2</span><span class="p">):</span>
    <span class="n">subs2</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">parser</span><span class="o">.</span><span class="n">initialized</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">ply.lex</span> <span class="kn">as</span> <span class="nn">lex</span>
            <span class="kn">import</span> <span class="nn">ply.yacc</span> <span class="kn">as</span> <span class="nn">yacc</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&quot;ply (used to parse the PrettyPFA) is not available on your system&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">lex</span><span class="p">,</span> <span class="n">yacc</span><span class="p">)</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">subs2</span><span class="p">)</span>

    <span class="n">anysubs</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
    <span class="n">anysubs</span><span class="o">.</span><span class="n">isDefinedAt</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Subs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">check</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="n">anysubs</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">PFAEngine</span><span class="o">.</span><span class="n">fromAst</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
</div>
<div class="viewcode-block" id="jsonNode"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.jsonNode">[docs]</a><span class="k">def</span> <span class="nf">jsonNode</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lineNumbers</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">subs2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ast</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">check</span><span class="p">,</span> <span class="n">subs</span><span class="p">,</span> <span class="o">**</span><span class="n">subs2</span><span class="p">)</span><span class="o">.</span><span class="n">jsonNode</span><span class="p">(</span><span class="n">lineNumbers</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="json"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.json">[docs]</a><span class="k">def</span> <span class="nf">json</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">lineNumbers</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">subs2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ast</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">check</span><span class="p">,</span> <span class="n">subs</span><span class="p">,</span> <span class="o">**</span><span class="n">subs2</span><span class="p">)</span><span class="o">.</span><span class="n">toJson</span><span class="p">(</span><span class="n">lineNumbers</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="engine"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.engine">[docs]</a><span class="k">def</span> <span class="nf">engine</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sharedState</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">multiplicity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s">&quot;pure&quot;</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">subs2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">PFAEngine</span><span class="o">.</span><span class="n">fromAst</span><span class="p">(</span><span class="n">ast</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">subs</span><span class="p">,</span> <span class="o">**</span><span class="n">subs2</span><span class="p">),</span> <span class="n">options</span><span class="p">,</span> <span class="n">sharedState</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>

<span class="c">###</span>
</div>
<span class="n">exprParser</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

<div class="viewcode-block" id="ppfas"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.ppfas">[docs]</a><span class="k">def</span> <span class="nf">ppfas</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">subs2</span><span class="p">):</span>
    <span class="n">subs2</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">exprParser</span><span class="o">.</span><span class="n">initialized</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">ply.lex</span> <span class="kn">as</span> <span class="nn">lex</span>
            <span class="kn">import</span> <span class="nn">ply.yacc</span> <span class="kn">as</span> <span class="nn">yacc</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s">&quot;ply (used to parse the PrettyPFA) is not available on your system&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">exprParser</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">lex</span><span class="p">,</span> <span class="n">yacc</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">exprParser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">subs2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ppfa"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.ppfa">[docs]</a><span class="k">def</span> <span class="nf">ppfa</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">subs2</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">ppfas</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">subs</span><span class="p">,</span> <span class="o">**</span><span class="n">subs2</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;use ppfa for single expressions, ppfas for multiple expressions&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="pfas"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.pfas">[docs]</a><span class="k">def</span> <span class="nf">pfas</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">jsonToAst</span><span class="o">.</span><span class="n">exprs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="pfa"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.pfa">[docs]</a><span class="k">def</span> <span class="nf">pfa</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">jsonToAst</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="expr"><a class="viewcode-back" href="../../titus.html#titus.prettypfa.expr">[docs]</a><span class="k">def</span> <span class="nf">expr</span><span class="p">(</span><span class="n">prettyPfa</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">subs2</span><span class="p">):</span>
    <span class="n">ppfa</span><span class="p">(</span><span class="n">prettyPfa</span><span class="p">,</span> <span class="n">subs</span><span class="p">,</span> <span class="o">**</span><span class="n">subs2</span><span class="p">)</span><span class="o">.</span><span class="n">jsonNode</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Titus TRUNK documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Open Data Group.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>
